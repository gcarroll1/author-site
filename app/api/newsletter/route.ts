import { NextResponse } from "next/server";import { z } from "zod";import nodemailer from "nodemailer";
export async function POST(req:Request){const fd=await req.formData();const email=String(fd.get("email")||"");const schema=z.object({email:z.string().email()});const ok=schema.safeParse({email});if(!ok.success)return NextResponse.json({ok:false,error:"Invalid email"},{status:400});try{const tx=nodemailer.createTransport({host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT||587),secure:false,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}});await tx.sendMail({from:process.env.MAIL_FROM||process.env.SMTP_USER,to:process.env.NEWSLETTER_TO||process.env.SMTP_USER,subject:"New newsletter signup",text:`Email: ${email}`});return NextResponse.redirect(new URL("/?subscribed=1",req.url));}catch(e){console.error(e);return NextResponse.json({ok:false,error:"Server error"},{status:500});} }